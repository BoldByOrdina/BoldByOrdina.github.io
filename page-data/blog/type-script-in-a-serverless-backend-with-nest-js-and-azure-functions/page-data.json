{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/type-script-in-a-serverless-backend-with-nest-js-and-azure-functions/","result":{"data":{"site":{"siteMetadata":{"title":"Ordina Bold Tech Blog","configs":{"countOfInitialPost":10}}},"markdownRemark":{"id":"ac6b32c8-5cdf-548b-90ed-c4a5d850427d","excerpt":"Introduction When I asked a colleague to validate my code structure for this blog, he asked me “Why would one use TypeScript in the backend at all?“. \nHe’s a Java programmer and didn’t know TypeScript’s properties very well. \nAn introduction: TypeScript is an asynchronous…","html":"<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.9.0/css/lightbox.css\" />\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap-grid-only@1.0.0/bootstrap.css\" />\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.9.0/js/lightbox.min.js\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/bootstrap-grid-only@1.0.0/index.min.js\"></script>\n<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>When I asked a colleague to validate my code structure for this blog, he asked me “Why would one use TypeScript in the backend at all?“.\nHe’s a Java programmer and didn’t know TypeScript’s properties very well.\nAn introduction: TypeScript is an asynchronous, functional programming language which compiles down to plain JavaScript.\nIt supports interfaces, classes and access modifiers like private, protected and public.</p>\n<p>When first using TypeScript, it felt less easy than using Spring Boot, which I had used prior during Java programming.\nThis is where NestJS comes in, a NodeJS framework built for the backend with Object Oriented Programming in mind.\nIf you have worked with a framework like Spring before, NestJS will be quite easy for you to understand.\nIt requires a modular way of working, which makes sure the application stays well organised. </p>\n<p>In this blog, we take a dive into using NestJS in a serverless application hosted in an Azure Function and connect it with a CosmosDB.\nOf course, NestJS can be integrated with other serverless services like <a href=\"https://blog.theodo.com/2019/06/deploy-a-nestjs-app-in-5-minutes-with-serverless-framework/\">AWS Lambda</a> and <a href=\"https://jacob-do.medium.com/token-validation-with-aws-cognito-and-nestjs-6f9e4088393c\">Cognito</a>.\nHowever, I found the process of converting this application to a serverless function to be a very smooth solution requiring only one(!) command.</p>\n<h2 id=\"setup\" style=\"position:relative;\"><a href=\"#setup\" aria-label=\"setup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h2>\n<p>I made a little application which can save and return three parameters of your body: weight, fat percentage and muscle percentage.\nThe app is automatically deployed to an Azure function using Azure Pipelines and saves those parameters to a CosmosDB.\nI made the code available on <a href=\"https://github.com/jasperrosiers/body-parameter-tracker\">GitHub</a> for you to learn from, as we won’t touch on everything in the repository in this blog post.</p>\n<p>The user can send new data to the application, which will keep the history of the three parameters in a CosmosDB.\nApart from the main <code class=\"language-text\">AppModule</code>, I only added two modules, the <code class=\"language-text\">ParametersModule</code> and the <code class=\"language-text\">LoggerModule</code> to the application.\nThis blog post won’t explain building the <code class=\"language-text\">LoggerModule</code>, as it only serves to create a custom logger.\nThe <a href=\"https://docs.nestjs.com/techniques/logger\">NestJS documentation</a> provides a very clear explanation of how to use a custom logger.</p>\n<p>The application has two (basic) guards set up for the HTTP calls, one for authorization and one for role-based access.\nFor this guard, we use a simple bearer token, however, integration with eg. Cognito or JWT tokens is available.</p>\n<h2 id=\"parametersmodule\" style=\"position:relative;\"><a href=\"#parametersmodule\" aria-label=\"parametersmodule permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ParametersModule</h2>\n<p>A Module in NestJS provides a clear way of organizing the project and enabling clear dependency injection.\nThere are four important things you can mark within a module: </p>\n<ul>\n<li><code class=\"language-text\">controllers</code>: classes which capture incoming HTTP calls</li>\n<li><code class=\"language-text\">providers</code>: classes marked with NestJS’s <code class=\"language-text\">@Injectable()</code>, made available for dependency injection</li>\n<li><code class=\"language-text\">imports</code>: modules that need to be imported, again for dependency injection</li>\n<li><code class=\"language-text\">exports</code>: subset of the providers that need to be exported for use in other modules</li>\n</ul>\n<p>The <code class=\"language-text\">ParametersModule</code> imports three other modules: the previously explained <code class=\"language-text\">LoggerModule</code>, the <code class=\"language-text\">ConfigModule</code> and the <code class=\"language-text\">AzureCosmosDBModule</code>.\nThe <code class=\"language-text\">ConfigModule</code> is used to be able to access environment variables from a <code class=\"language-text\">.env</code> file or from the configuration of the Azure Function.\nNote that this is also possible with a package such as <code class=\"language-text\">dotenv</code>, however this isn’t very ideal as we would have to access <code class=\"language-text\">process.env</code> directly every time.\nOf course, pushing those environment files to Git is bad practice.\nYou can find a <code class=\"language-text\">.env-sample</code> file in the repository, which is used to show which variables need to be filled in the <code class=\"language-text\">.env</code> file.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Module</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  controllers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>ParametersController<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  providers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      ParametersService<span class=\"token punctuation\">,</span> \n      ParametersRepository<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        provide<span class=\"token operator\">:</span> <span class=\"token constant\">APP_GUARD</span><span class=\"token punctuation\">,</span>\n        useClass<span class=\"token operator\">:</span> RolesGuard<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      LoggerModule<span class=\"token punctuation\">,</span>\n      ConfigModule<span class=\"token punctuation\">,</span>\n      AzureCosmosDbModule<span class=\"token punctuation\">.</span><span class=\"token function\">forFeature</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>dto<span class=\"token operator\">:</span> ParametersEntity<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ParametersModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>The first step when receiving an HTTP request to the application is the <code class=\"language-text\">ParametersController</code> as shown below.\nThis controller will catch all requests on the ‘parameters’ endpoint.\nUsing annotations, you can:</p>\n<ul>\n<li>Make a check for the type of incoming request and divide the traffic accordingly. This is similar to the way annotations work in the Spring Framework (eg. <code class=\"language-text\">@PostMapping</code>).</li>\n<li>Customise which HTTP code you want to return on successful calls, as I did with the <code class=\"language-text\">createParameters</code> method.</li>\n<li>Use the <code class=\"language-text\">@Res()</code> from <code class=\"language-text\">express</code> to send a completely customised response, however I did not use that here.</li>\n<li>Execute Guards before being able to activate the method</li>\n</ul>\n<p>Let’s focus on the <code class=\"language-text\">Post()</code> method.\nIt first asks the <code class=\"language-text\">parametersService</code> to check if there is an object with the given <code class=\"language-text\">userName</code> present in the database.\nWe could ask the <code class=\"language-text\">parametersRepository</code> for this information directly, however, having this layer of abstraction is essential for having cleaner code.\nIf there is no object present yet, it will create a new one, otherwise, it will update the existing one.\nFor this update, it will map the new info to the existing object.\nAgain, we use the <code class=\"language-text\">parametersService</code> for its abstraction layer, the controller should only be used for methods capturing HTTP calls.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Controller</span><span class=\"token punctuation\">(</span><span class=\"token string\">'parameters'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ParametersController</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">private</span> readonly parametersService<span class=\"token operator\">:</span> ParametersService<span class=\"token punctuation\">,</span> <span class=\"token keyword\">private</span> readonly loggerSerivce<span class=\"token operator\">:</span> LoggerService</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>loggerService<span class=\"token punctuation\">.</span><span class=\"token function\">setContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ParametersController'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    @<span class=\"token function\">Post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    @<span class=\"token function\">HttpCode</span><span class=\"token punctuation\">(</span>HttpStatus<span class=\"token punctuation\">.</span><span class=\"token constant\">CREATED</span><span class=\"token punctuation\">)</span>\n    @<span class=\"token function\">UseGuards</span><span class=\"token punctuation\">(</span>AuthGuard<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">async</span> <span class=\"token function\">createParameters</span><span class=\"token punctuation\">(</span>@<span class=\"token function\">Body</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> parametersDto<span class=\"token operator\">:</span> ParametersDto<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Promise<span class=\"token operator\">&lt;</span>ParametersEntity<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>parametersDto <span class=\"token operator\">||</span> parametersDto<span class=\"token punctuation\">.</span>userName <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>parametersDto<span class=\"token punctuation\">.</span>bodyWeight <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>parametersDto<span class=\"token punctuation\">.</span>fatPercentage <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>parametersDto<span class=\"token punctuation\">.</span>musclePercentage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// could implement @Res() from express to send a proper response to say it should at least contain one of the parameters or a userName</span>\n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">const</span> existingParams<span class=\"token operator\">:</span> ParametersEntity <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parametersService<span class=\"token punctuation\">.</span><span class=\"token function\">getParametersEntityByUserName</span><span class=\"token punctuation\">(</span>parametersDto<span class=\"token punctuation\">.</span>userName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>existingParams<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> updatedParams<span class=\"token operator\">:</span> ParametersEntity <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parametersService<span class=\"token punctuation\">.</span><span class=\"token function\">mapDtoToEntity</span><span class=\"token punctuation\">(</span>parametersDto<span class=\"token punctuation\">,</span> existingParams<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parametersService<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>updatedParams<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parametersService<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>parametersDto<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    @<span class=\"token function\">Get</span><span class=\"token punctuation\">(</span><span class=\"token string\">':id'</span><span class=\"token punctuation\">)</span>\n    @<span class=\"token function\">UseGuards</span><span class=\"token punctuation\">(</span>AuthGuard<span class=\"token punctuation\">)</span>\n    @<span class=\"token function\">Roles</span><span class=\"token punctuation\">(</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">async</span> <span class=\"token function\">findOne</span><span class=\"token punctuation\">(</span>@<span class=\"token function\">Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">'userName'</span><span class=\"token punctuation\">)</span> userName<span class=\"token operator\">:</span> string<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Promise<span class=\"token operator\">&lt;</span>ParametersEntity<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parametersService<span class=\"token punctuation\">.</span><span class=\"token function\">getParametersEntityByUserName</span><span class=\"token punctuation\">(</span>userName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    @<span class=\"token function\">Get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    @<span class=\"token function\">UseGuards</span><span class=\"token punctuation\">(</span>AuthGuard<span class=\"token punctuation\">)</span>\n    @<span class=\"token function\">Roles</span><span class=\"token punctuation\">(</span><span class=\"token string\">'admin'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">async</span> <span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Promise<span class=\"token operator\">&lt;</span>ParametersEntity<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parametersService<span class=\"token punctuation\">.</span><span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Moving on to the <code class=\"language-text\">ParametersService</code>, we’ll only take a glance at the <code class=\"language-text\">create()</code> function.\nWhen receiving an HTTP call, it will contain values for at least one of our three parameters.\nIn this method, we just check the values and add them to the respective array.\nThe <code class=\"language-text\">update</code> field contains the moment that the value gets updated to track the user’s progress over time.\nThe parameters will then be put into a <code class=\"language-text\">ParametersEntity</code> (Discussed in <a href=\"#azure-function-and-cosmosdb\">Azure Function and CosmosDB</a>) and added to the database using the <code class=\"language-text\">parametersRepository</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Injectable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ParametersService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">private</span> readonly parametersRepository<span class=\"token operator\">:</span> ParametersRepository</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">async</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span>parametersDto<span class=\"token operator\">:</span> ParametersDto<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Promise<span class=\"token operator\">&lt;</span>ParametersEntity<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> bodyweight<span class=\"token operator\">:</span> BodyweightDto<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> fatPercentage<span class=\"token operator\">:</span> PercentageDto<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> musclePercentage<span class=\"token operator\">:</span> PercentageDto<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>parametersDto<span class=\"token punctuation\">.</span>bodyWeight<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            bodyweight <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n                weight<span class=\"token operator\">:</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>parametersDto<span class=\"token punctuation\">.</span>bodyWeight<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                update<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>parametersDto<span class=\"token punctuation\">.</span>fatPercentage<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            fatPercentage <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n                percentage<span class=\"token operator\">:</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>parametersDto<span class=\"token punctuation\">.</span>fatPercentage<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                update<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>parametersDto<span class=\"token punctuation\">.</span>musclePercentage<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            musclePercentage <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n                percentage<span class=\"token operator\">:</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>parametersDto<span class=\"token punctuation\">.</span>musclePercentage<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                update<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parametersRepository<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ParametersEntity</span><span class=\"token punctuation\">(</span>parametersDto<span class=\"token punctuation\">.</span>userName<span class=\"token punctuation\">,</span> bodyweight<span class=\"token punctuation\">,</span> fatPercentage<span class=\"token punctuation\">,</span> musclePercentage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// More code</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">create()</code> function in the <code class=\"language-text\">ParametersRepository</code> adds the date the object was created and adds it to the database.\nWe see a good example of the <code class=\"language-text\">loggerService</code> here too.\nFirst, we set the context to ‘ParametersRepository’, so that, when it logs something, it will show that the log came from this class.\nThis way, logs can easily be retraced to its origin.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Injectable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ParametersRepository</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">@<span class=\"token function\">InjectModel</span><span class=\"token punctuation\">(</span>ParametersEntity<span class=\"token punctuation\">)</span> <span class=\"token keyword\">private</span> readonly container<span class=\"token operator\">:</span> Container<span class=\"token punctuation\">,</span> <span class=\"token keyword\">private</span> loggerService<span class=\"token operator\">:</span> LoggerService</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>loggerService<span class=\"token punctuation\">.</span><span class=\"token function\">setContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ParametersRepository'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">async</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span>item<span class=\"token operator\">:</span> ParametersEntity<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Promise<span class=\"token operator\">&lt;</span>ParametersEntity<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        item<span class=\"token punctuation\">.</span>createdAt <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>container<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>loggerService<span class=\"token punctuation\">.</span><span class=\"token function\">verbose</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Create RUs: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>response<span class=\"token punctuation\">.</span>requestCharge<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span>resource<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"authorization-guards\" style=\"position:relative;\"><a href=\"#authorization-guards\" aria-label=\"authorization guards permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authorization Guards</h2>\n<p>The project uses two guards, an <code class=\"language-text\">AuthGuard</code> for the authorization, and a <code class=\"language-text\">RolesGuard</code> to check which roles can access certain resources.\nA good explanation of both can be found in the <a href=\"https://docs.nestjs.com/guards\">NestJS documentation</a>.\nThe <code class=\"language-text\">RolesGuard</code> is almost an exact copy from the documentation, so let’s take a look at the <code class=\"language-text\">AuthGuard</code> which doesn’t need to be provided from a module.</p>\n<p>The <code class=\"language-text\">canActivate()</code> method is called before executing the method in the controller.\nIt needs to return <code class=\"language-text\">true</code>, or the method won’t execute and the application will return a 401 Unauthorized code.\nIn this case, we check if the authorization header has the correct value as configured in the environment variables.\nOther setups, like OAuth, Cognito or JWT tokens are also possible.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Injectable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AuthGuard</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">CanActivate</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">private</span> readonly configService<span class=\"token operator\">:</span> ConfigService</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">async</span> <span class=\"token function\">canActivate</span><span class=\"token punctuation\">(</span>context<span class=\"token operator\">:</span> ExecutionContext<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Promise<span class=\"token operator\">&lt;</span>boolean<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> req <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">switchToHttp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>req<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">.</span>authorization<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">.</span>authorization<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'Bearer'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpException</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Invalid token'</span><span class=\"token punctuation\">,</span> HttpStatus<span class=\"token punctuation\">.</span><span class=\"token constant\">FORBIDDEN</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">const</span> token <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">.</span>authorization<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> token <span class=\"token operator\">===</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>configService<span class=\"token punctuation\">.</span>get<span class=\"token operator\">&lt;</span>string<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token string\">'BEARER_TOKEN'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"azure-function-and-cosmosdb\" style=\"position:relative;\"><a href=\"#azure-function-and-cosmosdb\" aria-label=\"azure function and cosmosdb permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Azure Function and CosmosDB</h2>\n<p>To convert this app into an Azure Function and make it serverless, we only need a single command:</p>\n<p><code class=\"language-text\">nest add @nestjs/azure-func-http</code></p>\n<p>This will add some files and folders, including a <code class=\"language-text\">main.azure.ts</code> through which your app can be started.\nIt will set a global prefix ‘api’ to all your controllers, the standard for Azure Functions.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">createApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Promise<span class=\"token operator\">&lt;</span>INestApplication<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> NestFactory<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>AppModule<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AzureHttpRouter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  app<span class=\"token punctuation\">.</span><span class=\"token function\">setGlobalPrefix</span><span class=\"token punctuation\">(</span><span class=\"token string\">'api'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">await</span> app<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> app<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now, you can choose to either run your app as a normal Web App or a serverless Azure Function.\nThe only thing left to do is <a href=\"https://portal.azure.com/#create/Microsoft.FunctionApp\">create an Azure Function</a> in the Portal and set up a pipeline, which is also an automatic process (on Azure DevOps).\nThis will generate an <code class=\"language-text\">azure-pipelines.yml</code> file containing all necessary information and connect it with the function automatically.\nOn every push to the master branch (pull request), it will automatically start a build and deploy process.\nFor the environment variables, they need to be set up within the ‘configuration’ tab of your function, and then, you’re all set.’</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1784px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 77.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB4ElEQVQ4y5VUa4+bMBDk//+eSlX7sd/SKCpqKkgvinQR4SC8wyMYY5jubuv0dLk06UojY7CH2d2xnfCk8UIIa4PBgGKGja7roJSS58kYFEWBuq4xDAP6vpdvWmuZj+MocD6tExgzoTqdhGCeZxlPNIc8nxFGR5yVhqZ1bdvJxmmaBLz+NRxebMxIf+vlxds4qxFB1iBtNIrOQA1a1Fqyt+G4uxR5nmO5WGLxdQHP8wSr1Qqu61I6Cv+KK4Vf9gf0wxm7cItDcBDysiwvozHm3Y3vqROFwc9v6HQLP1qjKiuqUSsFt0XngnN6txRdKdwuXbRDCy/8gSIvkKQJ0jQVsMosy6RBtrOW/Cbh4vsztV6hLPaI4xjH4/ECnidJIqoZTdNcrHQLztPGoxoqBMkBURQhDENRx55jhayOyZjIjmwb9p/13ms4vudDjRrPRYYszYSsqirZYBvyP+FsfJ8MOyOm01KQIlbF6XJ6nIKt271mXGrok+cUbQj6kWzyN00mYZXWHg8Tbp82GKYZoZ6QZ79Ttp3l1Fmh+XMyHlHq7DYvVEODfdlSqrE0hsGk3BgebWeZ/C5hsNoCNV0KizVyOhnsRVZpjX3Pd1eEZUBqSMmHj5/lqLH3mIg/2lvlUTLGL4Mq2CmohZljAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Azure Function Creation\" title=\"Azure Function Creation\" src=\"/static/b60fe3dc2898cb4ef448d0b064831b99/a9577/Azure-pipeline.png\" srcset=\"/static/b60fe3dc2898cb4ef448d0b064831b99/0b533/Azure-pipeline.png 500w,\n/static/b60fe3dc2898cb4ef448d0b064831b99/00d43/Azure-pipeline.png 1000w,\n/static/b60fe3dc2898cb4ef448d0b064831b99/a9577/Azure-pipeline.png 1784w\" sizes=\"(max-width: 1784px) 100vw, 1784px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n<p>Congratulations!\nYou converted your app to a serverless Function!\nQuite an easy conversion, wasn’t it?</p>\n<p>The database connection is just as easy.\nAgain, in the portal, you can <a href=\"https://portal.azure.com/#create/Microsoft.DocumentDB\">create a CosmosDB Account</a>.\nIn that account, go to ‘Data Explorer’ and create a new database and add the necessary variables to the configuration of the Function.</p>\n<p>In the end, your <code class=\"language-text\">app.module.ts</code> should look like this.\nNotice that we can’t use the <code class=\"language-text\">ConfigService</code> in this <code class=\"language-text\">@Module()</code>, as it needs to be initialised before usage.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">@<span class=\"token function\">Module</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      ConfigModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      ParametersModule<span class=\"token punctuation\">,</span>\n      LoggerModule<span class=\"token punctuation\">,</span>\n      AzureCosmosDbModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          dbName<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">DATABASE_NAME</span><span class=\"token punctuation\">,</span>\n          endpoint<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">DATABASE_ENDPOINT</span><span class=\"token punctuation\">,</span>\n          key<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">DATABASE_KEY</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  controllers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      AppController\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  providers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      AppService<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>That’s it!\nYour app is now fully functional!</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>In this blog post, we made a small application to discover how NestJS can be used in the backend with some of its neat features.\nOf course, this was a very basic program to show some of the possibilities.\nFor more information on NestJS and its features, check out the very thorough <a href=\"https://docs.nestjs.com/\">documentation</a>.</p>\n<h2 id=\"resources\" style=\"position:relative;\"><a href=\"#resources\" aria-label=\"resources permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Resources</h2>\n<ul>\n<li><a href=\"https://github.com/jasperrosiers/body-parameter-tracker\">The body parameter tracker project</a></li>\n<li><a href=\"https://docs.nestjs.com/\">NestJS docs</a></li>\n<li><a href=\"https://blog.theodo.com/2019/06/deploy-a-nestjs-app-in-5-minutes-with-serverless-framework/\">AWS Lambda integration</a> </li>\n<li><a href=\"https://jacob-do.medium.com/token-validation-with-aws-cognito-and-nestjs-6f9e4088393c\">AWS Cognito integration</a></li>\n</ul>","headings":[{"depth":2,"value":"Introduction","id":"introduction"},{"depth":2,"value":"Setup","id":"setup"},{"depth":2,"value":"ParametersModule","id":"parametersmodule"},{"depth":2,"value":"Authorization Guards","id":"authorization-guards"},{"depth":2,"value":"Azure Function and CosmosDB","id":"azure-function-and-cosmosdb"},{"depth":2,"value":"Conclusion","id":"conclusion"},{"depth":2,"value":"Resources","id":"resources"}],"frontmatter":{"title":"TypeScript in a serverless backend with NestJS and Azure Functions","category":"TypeScript","tags":["TypeScript","Backend","NestJS","Azure","Serverless"],"image":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB80lEQVQoz3VTv2/TQBT2v4HEAOyMXboiKIhWqkBCCImBCYpAYmBhY6uYKiEYEANZQAK1ygaIDpTSYhKkCLVRSktix07iosSN7Nb22fHdfdgXm8bBedK7e757P77z+54EgEeCdE9s5Nnpd959KlKaiVMGzhJNHUTQcQBP9DghyxSLVeKUhqnPaHWMoRIrG+QgRUZihCRGNai3uPt+A/bL4tAxOosWYYfuDkjlBgKt+C/Q8nbQ7r8Tth+9zgsodJNA8tYrpH1+AerJi1w9PQtj7gFIqTqMYiHKug/r9xOw8jx2tQYU0xVXXrCPji3jaaWLR2sKCuUOCl86kA7ffCDdu4voXLrH1VOXoU/dRPvcHXBCsFY3ofd6oL9uw92cQdguQlZt1Lu2SLquEVwp1vD4q4olWcPSp2by5JAiqCm8NX0LyokL0M5eA+/b+NwwofacCM42SPU+eGDjm9KHYbkwDnwU5Bae/dBxfbmGmecVfKz2hgmJvIXuwiKPkTbPzMF6sZL8cYqS5sE2VgFnC3smQyNBt1z6g9ebBh6u7OHqq228/bkP4zCIusx5IDrnB9xd/Y5YMy0HQ+g0h9ZISx2fYtdwcHA0gDWg4qysHYmEfDJt8B95x2mTickQO+UdnUDsnAJsjNRMEHtk7vLGadKI5aGL97+vD4DVdR6s6QAAAABJRU5ErkJggg==","aspectRatio":1.7064846416382253,"src":"/static/c60137e276f4716cc30955d808295ab8/5d2c5/banner.png","srcSet":"/static/c60137e276f4716cc30955d808295ab8/53f65/banner.png 500w,\n/static/c60137e276f4716cc30955d808295ab8/5d2c5/banner.png 1000w","sizes":"(max-width: 1000px) 100vw, 1000px"}}},"authors":[{"id":"jasper_rosiers","name":"Jasper Rosiers","bio":"Jasper is a Java Developer with a love for IoT and innovative tech. He has a lot of experience in building chatbots using various platforms and coupling them to different chat clients. He also has a passion for the Agile way of working, Scrum and communication, both inside and outside the team.","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEv0lEQVQ4y12T2W9UVRzH5w/wSZ8gojVigEqBLthFqKW0FOyS7rSlVCy1LJZSaMemnc5y76yd/c56ZzoNS6QIUltETIAgi0pIiCTGFCUYQiioGCIvvqAPH8+dKX3w4Zsz58w9n9/39/udny6o+AkENfnwBzR58fu9+PwefD4PXq87fa595xdn2n9Opx273YrVJiHLFiySCZPJwNjYCDolrKCEggRDgYwUoeCLIH4i0TBup0R3VxtN9dXoBwcIiAAulyMNtb2AWowYjQZ0YXEhFAktSCGkBVgIomlwYD8Dezp5v2IjBXk5ZGUto6W5Ie120alVQpLMmM1j6KLxGJFYVCiCBn8RICz2smzE1NfFxeQ4Mz4TUX0v28uLWLk8i+HhQVEW70LqMpJwabaY0MUScWKqphiL8GgEfzCA127g0a2LMHeN+1MKt6IWZkd66CzLo7auOp2N3WHDJqCyLIm0zejiyQTxhJqWBtag2mp3OUlFffx5b475G1f4eeYEc1MqZ037MTa/R3lpMR7RNJf4zma3IVtl0RwLOnViAnUimZYG12Bh4TIk6icZzXxzbY4Tx7/GYRQOzF7ccoAParZRtH4ddqcDt2c8A7RZRdrSAjCVIiGk/daggUiE46IU969eYP7HX/l+5hI3EhFMB0YIBaZoq2tni3DoE2VxucfTYKst4/J/wJQAJgUwyqQA/zt/lyc3v+WP65e5f26G8K5mpiUD1o4GbH09+EMhXOOuRWDGYXIi40yDiTUm9qFYHEVAf7l5jWd3bvL09m1+SB5l8sBHzDj0ODtr8IgX4A0E0kBHGmgVTRE1jKpJYokMSFM0kSSiJnD5Apyf/YJ/nj7m+fwD7p46zSnDQdShbiz9vWIAgnh93nTKGlBL16x1ORJXiQpATIBiyWR61fbeQJCrF87z7LcHPHv0gHuXzjEx2sfQzkbcYkqUcFiMpYdxDejIAE0mo3iH8ThqIiEkuiykCuhkKonkdPPV7Jf8/dcTvrt+FTUSpn9vDztrKrDK5vRrGHe7M0DNobwAjIpHHFdVkqIJGkhzZ1Mm6TIkGTp4mOdPf+fxw4d8duwYXsMQXdvK2VxVTVgE0IZAA9odGaBRAwaDCjExZkpsgkPWOM2DUdqkMxS36MnO3cDs0RSP7vzElZkzqGLE8vOLeHlJFuvyCzl4eAhF1NLtcYsOLwIDGDwpGoePU7pbYfO+CE2Gk6ypHiCv1UJpXS/HQmEuT39OaVkVL73yGkvfyGFJ1iqWrShka0MnRrOE0+VizCiAktNP0+gUm3pClLRL1AweoebQJJUHJqgfmya/zc76yh3kFW/h1dx6sje2k71hOysLa1hZ0sKbRS2s3VDHkH447VK3ZyxEWa9CUcsoxe0yrfI5KvdGKN3loUU+S2GjnuVF9azedojiDhfrqnrJqxlkTcVuskvbWbv5QwFt5d3yWvEOxcPuMH3KO60G8moH2PJxIg0s6/aKMzNNpmnWN+jJEZdKOl0UbrcIUA/5DQbWbu0TTptZVVzP2+XdvL66lN59/ejqR0+KD/QUNHxCveE0jSLNTT0KBY0jVPWnKN7hIEe4KexwUNA8Ji73iPoOsrpyD8tzy3krt4IcAVy6ooTK2lb+AxiU6TaGwT2gAAAAAElFTkSuQmCC","aspectRatio":1,"src":"/static/20c3697dbb9574ba9608a343b42b1fb0/ee604/jasper-rosiers.png","srcSet":"/static/20c3697dbb9574ba9608a343b42b1fb0/69585/jasper-rosiers.png 200w,\n/static/20c3697dbb9574ba9608a343b42b1fb0/497c6/jasper-rosiers.png 400w,\n/static/20c3697dbb9574ba9608a343b42b1fb0/ee604/jasper-rosiers.png 800w,\n/static/20c3697dbb9574ba9608a343b42b1fb0/474dd/jasper-rosiers.png 1139w","sizes":"(max-width: 800px) 100vw, 800px"}}}}],"date":"November 12, 2020"}},"allMarkdownRemark":{"edges":[{"node":{"id":"bfa11ea8-4c20-5537-b7f0-a9ce63544f6b","fields":{"authorIds":["orjan_de_smet"],"slug":"/angular-custom-control/angular-custom-control/"},"frontmatter":{"date":"2020-08-15T00:00:00.000Z","title":"Creating a custom form control in Angular","type":"blog","tags":["Angular"],"image":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAACyUlEQVQoz03MC0hTcRgF8D+RgWGMLAJTh2BmRQr2UEEpC1c2zEZPo9REEMVMTcSwyErTTCWEUkvDLE2j18SG6Zybrm3u6ZzucXfH7nZ3X3NuQxNNSW8+CPxx+ODA4QPUfyRJEetxUqTbRSzMEt5pcrVu5iLdmysgCAIn1o6TxLzTmNeNu6ZIyDrVPegZHadcUziOb0xIinRaCO3GegPAHHYMdzgwzAA7BxXuJq43u94blz8NThF36q1zHgyxoajDTmEeof1Vj7YOR52oA3WsA2bbtFTn6eJ7n7ZPZVVjZ4vgY5m68Mty3/ihxJwRFINQG4EjngFbTePoVf2EcfUTgiC2dYAvtb/jmqpbNEXPJOn3BOxcXnTql7BzHYyYZuaJD23C8k5jBhcuqZQdkiqEKILBsNligdcCW0B718/axp6Syk9phW1lz3vYmU0HE6tC4h75R5ZuCy1obf/RMJKUPwy4oteIhdJDkMkEGSGzwWwxQWZQVdtUfP/FrbzqC2nlZ66UHWUVhkZnB0Rk+O9PBTtZFTUfjMax9t6qCaPNIfg497lcZ4ItqpH5rlKTcgTk3i5OTc9L4mTFJd6IiL0UFnU+KJy1Y2/MVsZhAPxYrGQIMk+OG8cNRvm3tpkH8b/fFiw2XEefJMvFQsBO5iScZkcdTwgJO8LYs2+Ljz8Avj6+u0PCDqTcvPaytVWjVqvUKo1SITFYFW01dG7QfEGkqJ+nnIRAcDBzux9jNQGBzOjYk4W5pd0t73VqhQtfoMfnlu2UVj8pl8lG1WMGXvdKTjiSFeFOY84/ZKskw4DD4VRUPObxehHESi+7SFrzdYUc+kMrO+j5eicNo5AN+SUSSbX6sboi88VAXl+/8E2dNWWX9HsnmJ3xCmU2voakLbq/2rvDdHPfEuRapJeXlwwUPCAWDQ7wJdI1gmExTyAaVanFcmUvXyCWSP8B8/vhYaTGXiQAAAAASUVORK5CYII=","aspectRatio":1.7094017094017093,"src":"/static/47eb4071e7b4fd828591dc6a4727299b/46604/qyt3dcd64l.png","srcSet":"/static/47eb4071e7b4fd828591dc6a4727299b/69585/qyt3dcd64l.png 200w,\n/static/47eb4071e7b4fd828591dc6a4727299b/497c6/qyt3dcd64l.png 400w,\n/static/47eb4071e7b4fd828591dc6a4727299b/46604/qyt3dcd64l.png 500w","sizes":"(max-width: 500px) 100vw, 500px"}}},"authors":[{"id":"orjan_de_smet","name":"Orjan De Smet"}]}}},{"node":{"id":"a46dec1a-1810-59b6-9a54-4d0dbf056d6e","fields":{"authorIds":["orjan_de_smet"],"slug":"/angular-include-assets-libraries/angular-include-assets-libraries/"},"frontmatter":{"date":"2019-09-13T00:00:00.000Z","title":"Lessons learned on including library assets into Angular applications","type":"blog","tags":["Angular","Builders","Assets","Library","Monorepo"],"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAECAwT/xAAWAQEBAQAAAAAAAAAAAAAAAAADAQL/2gAMAwEAAhADEAAAAdELUkYGi//EABgQAAMBAQAAAAAAAAAAAAAAAAECEBIR/9oACAEBAAEFAmPFGtRQFn//xAAXEQEBAQEAAAAAAAAAAAAAAAABAhAS/9oACAEDAQE/AZqeUTP/xAAWEQADAAAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8BNX//xAAYEAEBAAMAAAAAAAAAAAAAAAABEAAhQf/aAAgBAQAGPwJcB7dE/8QAGxABAAICAwAAAAAAAAAAAAAAAQARIUExUZH/2gAIAQEAAT8hqzkiLg08eo2TVal+hbuOZ//aAAwDAQACAAMAAAAQMN//xAAWEQADAAAAAAAAAAAAAAAAAAABECH/2gAIAQMBAT8QEoF//8QAFhEBAQEAAAAAAAAAAAAAAAAAARAR/9oACAECAQE/EBoRn//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExccH/2gAIAQEAAT8QTTFYPIBZdaDPuPTsCUv2KqWrKZSG1UqxKtn/2Q==","aspectRatio":1.7094017094017093,"src":"/static/db2bc63b7c104af4e01d98f84cf1f448/0f3a1/tpryd.jpg","srcSet":"/static/db2bc63b7c104af4e01d98f84cf1f448/f836f/tpryd.jpg 200w,\n/static/db2bc63b7c104af4e01d98f84cf1f448/2244e/tpryd.jpg 400w,\n/static/db2bc63b7c104af4e01d98f84cf1f448/0f3a1/tpryd.jpg 500w","sizes":"(max-width: 500px) 100vw, 500px"}}},"authors":[{"id":"orjan_de_smet","name":"Orjan De Smet"}]}}},{"node":{"id":"f8129530-ed91-5c32-8a14-06dd0f8775b7","fields":{"authorIds":[],"slug":"/designing-the-design-process/designing-the-design-process/"},"frontmatter":{"date":"2019-12-23T00:00:00.000Z","title":"Designing the design process","type":"blog","tags":["Design process"],"image":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABIUlEQVQY031RXU/DMAzM//9XvCEh7YGJSUyCMVg/Vpo1dZvESewUN1CeECcrsq2crTurZUMuwQWZOXGeUuacl79AnEOIiohWZiEIdcmZpZN5svh+BeuDDJRembytKZAdCiy6SD6yBKZskULiROwxGbAOY6IspQsRE48zVq0ewLlAslwdW3t36J4au6/nx2q6f7mdetsMXttYD74DlLy+uf0Fdh+wexvXz619OEM7RTUhNcYZJFF4BXd4rTrwEHgMJE15e9mmQZvpfGliSqs1mwIFPg4uAZJxyfg0ypTAUsKarC8EcrQgRmNAnBHtRfAqW/V6GozrejCj6/V8qTWG+OvKD3i1PReTJbbLZPV9pFAIn3p4Pp5ijMu/0ANXDZuRvwA9S89U6s2ehwAAAABJRU5ErkJggg==","aspectRatio":2.5,"src":"/static/267f0a920cea0607f3e61217bc86b013/ee604/1_0efMr1b_peoGJtTjTFK7Gg.png","srcSet":"/static/267f0a920cea0607f3e61217bc86b013/69585/1_0efMr1b_peoGJtTjTFK7Gg.png 200w,\n/static/267f0a920cea0607f3e61217bc86b013/497c6/1_0efMr1b_peoGJtTjTFK7Gg.png 400w,\n/static/267f0a920cea0607f3e61217bc86b013/ee604/1_0efMr1b_peoGJtTjTFK7Gg.png 800w,\n/static/267f0a920cea0607f3e61217bc86b013/df6db/1_0efMr1b_peoGJtTjTFK7Gg.png 939w","sizes":"(max-width: 800px) 100vw, 800px"}}},"authors":[]}}},{"node":{"id":"0673f839-434f-5d00-99fa-a0a7c81d286a","fields":{"authorIds":null,"slug":"/exploring-developers-perspectives-on-ux-dev-collaboration/exploring-developers-perspectives-on-ux-dev-collaboration/"},"frontmatter":{"date":"2021-03-16T00:00:00.000Z","title":"Exploring developers’ perspectives on UX/DEV collaboration","type":"blog","tags":["Collaboration","Developers","Designers"],"image":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAACa0lEQVQozx3RW0iTARQH8A/qMRrRU0EgGEVB9FCQZEQRReFMTed06bYUpULTNHowlCJCorw0021uQ5fT8PY5Z27zMrFZgmRO52Xev3lrm8lUsHQ5zr+PPRwOnIcf/z+H4ZwW39yYfX9nY2Zv2zsZWJ22B9xOc2Bp3Bpw87Po7AqsL/YEdOWNQXG0htKTdfRArCO5WMNvDUnjVZQc+5EkcVWhOzPvMG9ub26CNbAYGhhGILiFmQkL3DN9WJrshtvRifW5XijLW5AoVCMtSQdJjBqmT+2Y+/kNNYpaGNRlUL6vgDxRB8Y9bvFT8C+q3qqo22onDA+STyqmtRY1cbN9tPCmkPxPo8iiVBHLuqi9eZgyJHpKl+RTanIKGdR68nP95LAZiQeJWeLBf7tb8PrW6c/eLprlcpQcC4erIBML3414V9QI7sUNePSF4LyEqbFVyMVlCD8sAMMwiLwUiV62A7WVjZCJtHzCCZvf4/XBbLbS1OIKip/noFUUhq+VuVietsHeP4jt6RGstTVgfnkHncYxvloV7NnXobh2CIIjR+EaMmHA0gFpAg++yq8LFmdVokbZTQNmA2ZfRmE/9wQ8qjRwrj5s+BzwdLZhpUKLpnYXCnKakCLSoSdLhuyIMD7lQZS+/gB1SSufUAMmL7YIxfF5dF/4BMLTB6C4cxw/2FJ4nSZw413gv4xfoyxaFQ0Q3dUi9Z4K0kQtHkoMyDx3M1T78oXHkCXU82A1GLa2ecdYb4Ls9lW6dUaAKycFyIiJwOzIFyxP8uCoBb85G9TlTRBHVyNTooM4SY864TP0nD0VAi+ej8Mj6ecQ+B9X/bmZhUyg8AAAAABJRU5ErkJggg==","aspectRatio":2.4691358024691357,"src":"/static/54f73c719bdd776305ca12180c338fea/ee604/designer_vs_developer.png","srcSet":"/static/54f73c719bdd776305ca12180c338fea/69585/designer_vs_developer.png 200w,\n/static/54f73c719bdd776305ca12180c338fea/497c6/designer_vs_developer.png 400w,\n/static/54f73c719bdd776305ca12180c338fea/ee604/designer_vs_developer.png 800w,\n/static/54f73c719bdd776305ca12180c338fea/f3583/designer_vs_developer.png 1200w,\n/static/54f73c719bdd776305ca12180c338fea/5707d/designer_vs_developer.png 1600w,\n/static/54f73c719bdd776305ca12180c338fea/716b1/designer_vs_developer.png 1982w","sizes":"(max-width: 800px) 100vw, 800px"}}},"authors":null}}},{"node":{"id":"49255925-7978-5acd-86b6-9532d98a8ebd","fields":{"authorIds":["dimitri_de_kerf"],"slug":"/flutter/Flutter/"},"frontmatter":{"date":"2019-01-10T00:00:00.000Z","title":"Flutter: Hybrid apps for mobile & beyond.","type":"blog","tags":["Android","Flutter","Hybrid","iOS","Mobile"],"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAdxZAX//xAAWEAEBAQAAAAAAAAAAAAAAAAASICH/2gAIAQEAAQUCWqf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAVEAEBAAAAAAAAAAAAAAAAAAARIP/aAAgBAQAGPwIr/8QAGRAAAwADAAAAAAAAAAAAAAAAAAERIEFR/9oACAEBAAE/IXD7SkcYnVh//9oADAMBAAIAAwAAABD8z//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/ECf/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPxBn/8QAGxABAQACAwEAAAAAAAAAAAAAAREAIRAxUUH/2gAIAQEAAT8QCLpo+u5rEmNDuGQGJfchbC+8/wD/2Q==","aspectRatio":1.7094017094017093,"src":"/static/5f8cf980de18550faa6eceb046966447/14b42/Flutter.jpg","srcSet":"/static/5f8cf980de18550faa6eceb046966447/f836f/Flutter.jpg 200w,\n/static/5f8cf980de18550faa6eceb046966447/2244e/Flutter.jpg 400w,\n/static/5f8cf980de18550faa6eceb046966447/14b42/Flutter.jpg 800w,\n/static/5f8cf980de18550faa6eceb046966447/a7715/Flutter.jpg 1000w","sizes":"(max-width: 800px) 100vw, 800px"}}},"authors":[{"id":"dimitri_de_kerf","name":"Dimitri De Kerf"}]}}}]}},"pageContext":{"slug":"/typescript-backend-nestjs/Typescript-in-a-serverless-backend-with-NestJS-and-Azure-Functions/"}},"staticQueryHashes":["3128451518"]}